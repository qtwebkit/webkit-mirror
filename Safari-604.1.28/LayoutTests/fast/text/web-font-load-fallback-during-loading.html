<!DOCTYPE html>
<html>
<head>
<script>
if (window.internals) {
    internals.settings.setWebFontsAlwaysFallBack(true);
    internals.clearMemoryCache();
    internals.invalidateFontCache();
}
</script>
<style>
@font-face {
    font-family: "WebFont";
    src: url("../../resources/Ahem.ttf") format("truetype"), local("American Typewriter");
}
@font-face {
    font-family: "WebFont2";
    src: local("American Typewriter");
}
@font-face {
    font-family: "WebFont2";
    src: url("../../resources/Ahem.ttf") format("truetype");
}
@font-face {
    font-family: "WebFont3";
    src: url("../../resources/Ahem.ttf") format("truetype");
}
</style>
</head>
<body>
<div style="-webkit-text-size-adjust: none;">
This test makes sure that fallback fonts are used during the time when fonts are loading.
<p id="console">Test NOT complete.</p>
<p><span id="americanTypewriter" style="font-family: 'American Typewriter';">This is a test rendering.</span></p>
<p id="container"><span id="notAmericanTypewriter" style="font-family: 'WebFont';">This is a test rendering.</span></p>
<p><span style="font-family: 'WebFont2';">PASS: This is rendered with American Typewriter.</span></p>
<!-- Because the primary font is the platform-dependent interstitial font, the baseline position of the line is calculated with this platform-specific font, which means we can't test it with a ref test because we don't know exactly where the text will end up. -->
<!--p><span style="font-family: 'WebFont3', 'American Typewriter';">PASS: This is rendered with American Typewriter.</span></p-->
</div>
<script>
var console = document.getElementById("console");
var americanTypewriterWidth = document.getElementById("americanTypewriter").getBoundingClientRect().width;
var notAmericanTypewriterWidth = document.getElementById("notAmericanTypewriter").getBoundingClientRect().width;
if (americanTypewriterWidth == notAmericanTypewriterWidth)
    console.innerText = "FAIL: Element should not be rendered with American Typewriter.";
else
    console.innerText = "PASS: Element is not rendered with American Typewriter.";
document.getElementById("container").style.display = "none";
</script>
</body>
</html>
